<!DOCTYPE html>
<html>
<head>
  <title>Socket.IO Example</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.js"></script>
  <script>
    const socket = io('http://localhost:4000'); // Connect to the server
    let room = "";
    let roomId = ''
    socket.on('message', (data) => {
      console.log('Received message:', data);
    });

    socket.on('roomMessage', (data) => {
      console.log('Received message from room:', data);
    });

    function sendMessage() {
      let message = document.getElementById('message').value;
      console.log("trying to send message ", message);
      socket.emit('roomMessage', { room: room, message: message });
    }

    function joinRoom() {
      console.log("emitting to ",roomId);
      socket.emit("joinRoom",roomId)
    }

    socket.on('playerjoined', ()=>{
      // refresh waiting list using api
      console.log("New player joined, refresh all pending players");
    })


    socket.on('update', (data) => {
      // call update board api
      console.log(data);
    });

    socket.on('kickinactive', ()=>{
      // call leave api
    })

    function createGame() {
      const url = 'http://localhost:4000/game/createGame';
      const body = {
        boardId: '1',
        numberOfPlayers: 4
      };
      const headers = {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyTmFtZSI6Im1vbW8zIiwicGFzc3dvcmQiOiIkMmEkMTAkdFVHZ0FWMjZVZThIUktqRmRYM1NVZVdNOWY2dUJjbkouR0tLd2hQRmJBem1iWTRZZElVcHEiLCJ1c2VySWQiOjMsImlhdCI6MTY4OTA2Mzk5OH0.mHJQxUhvrMa5YoBmwIE0y6Ola7lOvsGcj-hpQV_KlGw'
      };

      fetch(url, {
        method: 'POST',
        headers: headers,
        body: JSON.stringify(body)
      })
        .then(response => response.json())
        .then(data => {
          console.log('Game created:', data);
          // socket.emit(data.games.roomId,"hey")
          roomId = data.game.roomId
          joinRoom(data.game.roomId)

        })
        .catch(error => {
          console.error('Error creating game:', error);
        });
    }


    function joinGame() {
      const url = 'http://localhost:4000/game/joinGame';
      const body = {
        "gameId": 25
      } 
      const headers = {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyTmFtZSI6Im1vbW8zIiwicGFzc3dvcmQiOiIkMmEkMTAkdFVHZ0FWMjZVZThIUktqRmRYM1NVZVdNOWY2dUJjbkouR0tLd2hQRmJBem1iWTRZZElVcHEiLCJ1c2VySWQiOjMsImlhdCI6MTY4OTA2Mzk5OH0.mHJQxUhvrMa5YoBmwIE0y6Ola7lOvsGcj-hpQV_KlGw'
      };

      fetch(url, {
        method: 'POST',
        headers: headers,
        body: JSON.stringify(body)
      })
        .then(response => response.json())
        .then(data => {
          joinRoom(data.game.roomId)
        })
        .catch(error => {
          console.error('Error creating game:', error);
        });
    }
  </script>
</head>
<body>
  <!-- <input type="text" id="message" placeholder="Enter a message">
  <button onclick="sendMessage()">Send</button>

  <input type="text" id="room" placeholder="Join Room"> -->
  <button onclick="joinGame()">Join</button>

  <button onclick="createGame()">Create Game</button>
</body>
</html>
